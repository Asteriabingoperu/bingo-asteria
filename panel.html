<body>

    <h1>Bingo Asteria Per√∫</h1>

    <!-- estrellas -->
    <div class="stars"> ... </div>

    <!-- aqu√≠ est√° el contenedor de n√∫meros -->
    <div id="numbers-container"></div>

</body>
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bingo Asteria Per√∫ - Panel</title>
<style>
  :root{
    --fondo:#061634; /* azul profundo */
    --amarillo:#FFC300;
    --amarillo-hover:#e6b800;
    --celeste-pastel:#c8e9ff; /* color para casillero pagado */
    --blanco:#ffffff;
    --gris-card:#0f2a4a;
    --gris-tile:#f6f8fb;
    --texto-tile:#071640;
  }
  html,body{height:100%;margin:0;font-family:Inter,Arial,Helvetica,sans-serif;background:var(--fondo);color:var(--blanco);}
  .wrap{max-width:1200px;margin:18px auto;padding:18px;}
  header{display:flex;align-items:center;justify-content:center;gap:10px}
  header h1{margin:0;font-size:32px;color:var(--amarillo);letter-spacing:1px}
  .topbar{display:flex;gap:16px;align-items:center;justify-content:space-between;margin:18px 0}
  .left-config{width:320px}
  .field{margin-bottom:12px}
  .label{font-size:14px;opacity:0.9;margin-bottom:6px}
  input[type="text"], input[type="number"], .big-input{
    width:100%;padding:12px;border-radius:10px;border:0;font-size:18px; box-sizing:border-box;
  }
  .big-input{background:var(--amarillo); color:#071640; font-weight:700}
  .controls{background:rgba(255,255,255,0.04);padding:16px;border-radius:12px}
  .btn{display:inline-block;padding:12px 18px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
  .btn-primary{background:var(--amarillo);color:#071640}
  .btn-secondary{background:#123454;color:var(--blanco)}
  .speed{display:flex;gap:8px;margin-top:8px}
  .speed .opt{padding:8px 12px;border-radius:8px;background:#0f2a4a;cursor:pointer}
  .grid-wrap{display:flex;gap:20px;margin-top:20px}
  /* tile grid */
  .tiles{flex:1;background:rgba(255,255,255,0.04);padding:14px;border-radius:12px;display:flex;flex-direction:column;align-items:center}
  .grid{
    width:100%;
    display:grid;
    gap:10px;
    grid-template-columns: repeat(5, minmax(60px,1fr));
  }
  .tile{
    background:#ffffff; color:var(--texto-tile);
    border-radius:8px;padding:14px; text-align:center; position:relative;
    border:1px solid rgba(7,22,64,0.06); cursor:pointer; user-select:none;
    transition:transform .15s, box-shadow .15s, background .15s;
    min-height:84px; display:flex; flex-direction:column; justify-content:space-between;
  }
  .tile:active{transform:translateY(2px)}
  .tile .status-paid{position:absolute;right:8px;bottom:8px;background:var(--amarillo);color:#071640;padding:4px 8px;border-radius:12px;font-weight:700;font-size:12px;display:none}
  .tile.paid{background:var(--celeste-pastel); color:#071640}
  .tile.paid .status-paid{display:inline-block}
  .tile .num{font-size:28px;font-weight:800}
  .tile .lbl{font-size:13px;color:rgba(7,22,64,0.6);margin-bottom:6px}
  .stars{display:flex;gap:4px;justify-content:center;margin-top:6px}
  .star{width:14px;height:14px;border-radius:50%;background:#e6edf7;border:1px solid rgba(7,22,64,0.08)}
  .star.on{background:var(--amarillo);box-shadow:0 0 6px rgba(255,195,0,0.4)}
  /* right panel */
  .right-panel{width:300px;display:flex;flex-direction:column;gap:12px}
  .card{background:rgba(255,255,255,0.04);padding:16px;border-radius:10px}
  .big-ball{width:180px;height:180px;border-radius:50%;background:linear-gradient(180deg,#ffd54d,#ffb300);display:flex;align-items:center;justify-content:center;font-size:72px;font-weight:900;color:#071640;margin:0 auto;box-shadow:0 6px 24px rgba(0,0,0,0.4)}
  .last-number{font-size:48px;color:var(--amarillo);font-weight:800;background:rgba(255,255,255,0.05);padding:14px;border-radius:8px;text-align:center}
  .winners-list{list-style:none;padding:0;margin:0}
  .history{max-height:180px;overflow:auto;margin-top:8px}
  footer{margin-top:22px;text-align:center;font-size:13px;opacity:0.8}
  /* modal */
  .modal-back{position:fixed;inset:0;background:rgba(1,8,24,0.6);display:none;align-items:center;justify-content:center;z-index:1200}
  .modal{background:#0f2a4a;padding:18px;border-radius:12px;color:var(--blanco);width:350px;box-shadow:0 14px 40px rgba(2,10,30,0.6)}
  .modal h3{margin:0 0 8px 0;color:var(--amarillo)}
  .modal .row{display:flex;gap:8px;margin-top:8px}
  .small{font-size:13px;opacity:0.9}
  /* responsive */
  @media(max-width:900px){
    .wrap{padding:12px}
    .grid-wrap{flex-direction:column}
    .left-config{width:auto}
    .right-panel{width:100%}
    .grid{grid-template-columns: repeat(3, minmax(60px,1fr));}
    .big-ball{width:140px;height:140px;font-size:56px}
  }
</style>
</head>
<body>
<div class="wrap">
  <header><h1>üèÜ BINGO ASTERIA PER√ö</h1></header>   
    <div class="sorteo-bola">
    <div class="bola-luz"></div>
    <div class="bola-numero" id="bola-numero">--</div>
    <div class="explosion-colores"></div>
</div>
    <!-- BOLA DE SORTEO ANIMADA -->
<div class="sorteo-bola">
    <div class="bola-luz"></div>
    <div class="bola-numero" id="bola-numero">--</div>
    <div class="explosion-colores"></div>
</div>
                                                                                                               

  <div class="topbar">
    <div class="left-config">
      <div class="field">
        <div class="label">N√∫mero de Premios</div>
        <input id="numPrizes" type="number" value="2" min="1" class="big-input"/>
      </div>

      <div class="field">
        <div class="label">1¬∫ Premio (S/)</div>
        <input id="prize1" type="text" value="20" class="big-input"/>
      </div>
      <div class="field">
        <div class="label">2¬∫ Premio (S/)</div>
        <input id="prize2" type="text" value="15" class="big-input"/>
      </div>

      <div class="field">
        <div class="label">Precio (ej. por n√∫mero)</div>
        <input id="price" type="text" value="variable" class="big-input"/>
      </div>

      <div class="field">
        <div class="label">Tel√©fono de referencia</div>
        <input id="refPhone" type="text" value="905888379 - Mar√≠a Cusicahua" class="big-input"/>
      </div>

      <div class="field">
        <div class="label">Fecha y Hora</div>
        <div style="display:flex;gap:8px">
          <input id="date" type="text" value="18/11/2025" style="padding:10px;border-radius:8px;border:0;flex:1"/>
          <input id="time" type="text" value="17:30" style="padding:10px;border-radius:8px;border:0;width:120px"/>
        </div>
      </div>
    </div>

    <div class="grid-wrap">
      <div class="tiles card" style="min-width:380px;max-width:740px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div style="font-weight:800;font-size:18px">Tablero</div>
          <div class="small">Fila de 5</div>
        </div>

        <div style="margin-top:12px;display:flex;gap:12px;align-items:center">
          <div class="card" style="padding:10px">
            <div class="big-ball" id="displayBall">--</div>
            <div style="margin-top:10px;font-weight:700">N√öMERO</div>
            <div style="margin-top:8px">Estrellas activadas: <span id="totalStars">0</span></div>
          </div>

          <div style="flex:1">
            <div style="display:flex;gap:8px;margin-bottom:10px">
              <button class="btn btn-primary" id="startBtn">‚ñ∂ Iniciar Sorteo</button>
              <button class="btn btn-secondary" id="newGameBtn">Nuevo Juego</button>
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <div class="label">Velocidad:</div>
              <div class="speed">
                <div class="opt" data-speed="1000">1x</div>
                <div class="opt" data-speed="700">1.5x</div>
                <div class="opt" data-speed="400">2x</div>
              </div>
            </div>
            <div style="margin-top:12px">
              <div class="label">Ganadores</div>
              <div class="card" id="winnersCard" style="min-height:80px">Los ganadores aparecer√°n aqu√≠.</div>
            </div>
            <div style="margin-top:12px">
              <div class="label">√öltimo n√∫mero</div>
              <div class="last-number" id="lastNumber">-</div>
            </div>
            <div style="margin-top:12px">
              <div class="label">N√∫meros Salientes</div>
              <div class="history card" id="historyList"></div>
            </div>
          </div>
        </div>

        <div style="margin-top:16px">
          <div class="grid" id="grid"></div>
        </div>
      </div>

      <aside class="right-panel">
        <div class="card">
          <div style="font-weight:700">Configurar cantidad de n√∫meros</div>
          <div style="margin-top:8px">Total n√∫meros:</div>
          <input id="totalNumbers" type="number" min="5" value="30" style="padding:8px;border-radius:8px;border:0;width:100%;margin-top:8px"/>
          <div style="font-size:13px;opacity:.9;margin-top:6px">El panel se ajustar√° autom√°ticamente (fila de 5).</div>
          <button class="btn btn-secondary" id="applyCount" style="margin-top:8px">Aplicar</button>
        </div>

        <div class="card">
          <div style="font-weight:700">Asignar jugador (clic en n√∫mero)</div>
          <div class="small">Al hacer clic en un n√∫mero se abre el formulario.</div>
        </div>

        <div class="card">
          <div style="font-weight:700">Tabla de jugadores</div>
          <div style="max-height:220px;overflow:auto" id="playersTable"></div>
        </div>
      </aside>
    </div>
  </div>

  <footer>¬© Bingo Asteria Per√∫ ‚Äî Energ√≠a, Universo, Fluir</footer>
</div>

<!-- modal -->
<div class="modal-back" id="modalBack">
  <div class="modal" role="dialog" aria-modal="true">
    <h3 id="modalTitle">Asignar Jugador al N¬∫</h3>
    <div style="margin-top:8px" class="small">Nombre</div>
    <input id="playerName" type="text" placeholder="Nombre" style="padding:8px;border-radius:8px;border:0;width:100%"/>
    <div class="row" style="margin-top:8px">
      <input id="playerLast" type="text" placeholder="Apellido" style="flex:1;padding:8px;border-radius:8px;border:0"/>
      <input id="playerPhone" type="text" placeholder="Tel√©fono" style="width:140px;padding:8px;border-radius:8px;border:0"/>
    </div>
    <div style="margin-top:8px;display:flex;align-items:center;gap:8px">
      <input id="playerPaid" type="checkbox"/>
      <div class="small">Pago confirmado?</div>
    </div>
    <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
      <button class="btn btn-secondary" id="modalCancel">Cancelar</button>
      <button class="btn btn-primary" id="modalSave">Guardar</button>
    </div>
  </div>
</div>

<script>
/* --- Datos y estado --- */
const storageKey = 'asteria_state_v1';
let state = {
  totalNumbers: 30,
  grid: {}, // info por n√∫mero {num: {stars:0, paid:false, player:{name,lastname,phone}}}
  history: [], // array de n√∫meros salida
  winners: [],
  speed: 1000
};

/* helpers para persistencia */
function saveState(){ localStorage.setItem(storageKey, JSON.stringify(state)); }
function loadState(){ const s=localStorage.getItem(storageKey); if(s) state=JSON.parse(s); }

/* carga inicial */
loadState();

/* DOM refs */
const gridEl = document.getElementById('grid');
const totalNumbersInput = document.getElementById('totalNumbers');
const applyCountBtn = document.getElementById('applyCount');
const displayBall = document.getElementById('displayBall');
const lastNumberEl = document.getElementById('lastNumber');
const historyList = document.getElementById('historyList');
const winnersCard = document.getElementById('winnersCard');
const playersTable = document.getElementById('playersTable');
const totalStarsEl = document.getElementById('totalStars');

/* modal refs */
const modalBack = document.getElementById('modalBack');
const modalTitle = document.getElementById('modalTitle');
const playerName = document.getElementById('playerName');
const playerLast = document.getElementById('playerLast');
const playerPhone = document.getElementById('playerPhone');
const playerPaid = document.getElementById('playerPaid');
const modalSave = document.getElementById('modalSave');
const modalCancel = document.getElementById('modalCancel');

let currentTile = null; // n√∫mero sobre el que abrimos modal

/* generar grid din√°mico */
function ensureGrid(n){
  state.totalNumbers = n;
  // initialize grid entries if missing
  for(let i=1;i<=n;i++){
    if(!state.grid[i]) state.grid[i] = {stars:0,paid:false,player:null};
  }
  // remove higher numbers if decreased
  Object.keys(state.grid).forEach(k=>{
    const num = parseInt(k,10);
    if(num>n) delete state.grid[k];
  });
  saveState();
  renderGrid();
  renderPlayers();
  renderHistory();
  renderWinners();
}
function renderGrid(){
  gridEl.innerHTML='';
  const n = state.totalNumbers||30;
  for(let i=1;i<=n;i++){
    const info = state.grid[i] || {stars:0,paid:false,player:null};
    const t = document.createElement('div');
    t.className='tile';
    if(info.paid) t.classList.add('paid');
    t.dataset.num = i;
    // label
    const lbl = document.createElement('div');
    lbl.className='lbl';
    lbl.textContent = info.player ? 'Reservado' : 'Libre';
    // number
    const numEl = document.createElement('div');
    numEl.className='num';
    numEl.textContent = i;
    // stars
    const starsWrap = document.createElement('div');
    starsWrap.className='stars';
    for(let s=1;s<=5;s++){
      const st = document.createElement('div');
      st.className='star' + (s<=info.stars ? ' on' : '');
      starsWrap.appendChild(st);
    }
    // paid badge
    const paidBadge = document.createElement('div');
    paidBadge.className='status-paid';
    paidBadge.textContent = 'Pagado';
    // assemble
    t.appendChild(lbl);
    t.appendChild(numEl);
    t.appendChild(starsWrap);
    t.appendChild(paidBadge);
    t.addEventListener('click', ()=> openModalFor(i));
    gridEl.appendChild(t);
  }
}

/* modal */
function openModalFor(num){
  currentTile = num;
  modalTitle.textContent = `Asignar Jugador al N¬∫ ${num}`;
  const info = state.grid[num] || {stars:0,paid:false,player:null};
  if(info.player){
    playerName.value = info.player.name || '';
    playerLast.value = info.player.last || '';
    playerPhone.value = info.player.phone || '';
  } else {
    playerName.value = 'Maria';
    playerLast.value = 'Cusicahua';
    playerPhone.value = '905888379';
  }
  playerPaid.checked = !!info.paid;
  modalBack.style.display='flex';
}
modalCancel.onclick = ()=>{ modalBack.style.display='none'; currentTile=null; };

/* guardar modal */
modalSave.onclick = ()=>{
  if(!currentTile) return;
  const p = {name:playerName.value||'', last:playerLast.value||'', phone:playerPhone.value||''};
  const paid = !!playerPaid.checked;
  state.grid[currentTile].player = p;
  state.grid[currentTile].paid = paid;
  saveState();
  renderGrid();
  renderPlayers();
  modalBack.style.display='none';
  currentTile = null;
};

/* players table */
function renderPlayers(){
  const rows = [];
  Object.keys(state.grid).forEach(k=>{
    const i=parseInt(k,10); const info = state.grid[i];
    if(info && info.player){
      rows.push(`<div style="padding:8px;border-bottom:1px solid rgba(255,255,255,0.03)"><strong>#${i}</strong> ${info.player.name} ${info.player.last} <div style="opacity:.8">${info.player.phone}</div> <div style="margin-top:6px">${info.paid?'<span style="background:var(--amarillo);color:#071640;padding:4px 8px;border-radius:8px;font-weight:700">Pagado</span>':''}</div></div>`);
    }
  });
  playersTable.innerHTML = rows.length?rows.join(''):'<div style="opacity:.8">No hay jugadores registrados</div>';
}

/* historial y winners */
function renderHistory(){
  historyList.innerHTML = state.history.map((n, idx)=>`<div style="padding:6px;border-bottom:1px dashed rgba(255,255,255,0.03)">${idx+1}. ${n} (veces: ${countOccurrences(n)})</div>`).reverse().join('');
  lastNumberEl.textContent = state.history.length?state.history[state.history.length-1]:'-';
  totalStarsEl.textContent = calcTotalStars();
}
function renderWinners(){
  if(state.winners.length===0) winnersCard.innerHTML = 'Los ganadores aparecer√°n aqu√≠.';
  else winnersCard.innerHTML = state.winners.map(w=>`<div style="padding:6px;border-bottom:1px solid rgba(255,255,255,0.03)"><strong>N¬∫ ${w.num}</strong> ‚Äî ${w.when}</div>`).join('');
}

/* contar ocurrencias en history */
function countOccurrences(n){
  return state.history.filter(x=>x==n).length;
}
function calcTotalStars(){ let s=0; Object.values(state.grid).forEach(it=>s+=it.stars); return s; }

/* sorteo */
let autoTimer=null;
let pool=[];

function buildPool(){
  // pool holds all numbers 1..totalNumbers (with repeats allowed across draws)
  pool = [];
  for(let i=1;i<=state.totalNumbers;i++) pool.push(i);
}

/* toma aleatorio sin quitar para permitir repetici√≥n (pero queremos que se repitan para pintar estrellas) */
function drawNumber(){
  if(pool.length===0) buildPool();
  const idx = Math.floor(Math.random()*pool.length);
  const num = pool[idx];
  // record
  state.history.push(num);
  // update stars (cap 5)
  const info = state.grid[num] || (state.grid[num]={stars:0,paid:false,player:null});
  info.stars = Math.min(5, info.stars+1);
  // check winner
  if(info.stars === 5){
    // add winner record if not yet in winners
    if(!state.winners.find(w=>w.num===num)){
      state.winners.push({num: num, when: new Date().toLocaleString()});
    }
  }
  // visual
  displayBall.textContent = num;
  lastNumberEl.textContent = num;
  speakNumber(num);
  saveState();
  renderGrid();
  renderHistory();
  renderWinners();
}

/* voz femenina */
function speakNumber(n){
  const text = `${n}`;
  const utter = new SpeechSynthesisUtterance(text);
  utter.lang = 'es-PE';
  utter.pitch = 1.0;
  utter.rate = 0.95;
  let voices = speechSynthesis.getVoices();
  // pick common female voices heuristically
  const fem = voices.find(v => /female|femenina|maria|sofia|sara|lynne/i.test(v.name)) || voices.find(v => /female|woman/i.test(v.name));
  if(fem) utter.voice = fem;
  speechSynthesis.speak(utter);
}

/* start/stop auto draw */
const startBtn = document.getElementById('startBtn');
const newGameBtn = document.getElementById('newGameBtn');

startBtn.onclick = ()=>{
  if(autoTimer){
    clearInterval(autoTimer); autoTimer=null; startBtn.textContent='‚ñ∂ Iniciar Sorteo';
  } else {
    if(!state.totalNumbers || state.totalNumbers<1) { alert('Ajusta la cantidad de n√∫meros'); return; }
    buildPool();
    autoTimer = setInterval(()=>{ drawNumber(); }, state.speed || 1000);
    startBtn.textContent='‚è∏ Detener Sorteo';
  }
};

newGameBtn.onclick = ()=>{
  if(confirm('¬øCrear nuevo juego? Esto reestablece historial y estrellas pero mantiene la configuraci√≥n.')){
    // reset stars and history and winners but keep players/payments? We'll keep players but clear stars/history/winners
    Object.keys(state.grid).forEach(k=>{ state.grid[k].stars = 0; });
    state.history = [];
    state.winners = [];
    saveState(); renderGrid(); renderHistory(); renderWinners();
    displayBall.textContent='--'; lastNumberEl.textContent='-';
  }
};

/* speeds */
document.querySelectorAll('.speed .opt').forEach(el=>{
  el.addEventListener('click', ()=> {
    document.querySelectorAll('.speed .opt').forEach(x=>x.style.boxShadow='none');
    el.style.boxShadow='inset 0 0 0 2px rgba(255,195,0,0.2)';
    state.speed = parseInt(el.dataset.speed,10);
    saveState();
    if(autoTimer){ clearInterval(autoTimer); autoTimer = setInterval(()=> drawNumber(), state.speed); }
  });
});

/* apply count */
applyCountBtn.onclick = ()=>{
  const n = Math.max(5, parseInt(totalNumbersInput.value,10) || 30);
  ensureGrid(n);
};

/* init defaults */
(function init(){
  const n = state.totalNumbers || parseInt(totalNumbersInput.value,10) || 30;
  totalNumbersInput.value = n;
  totalNumbersInput.addEventListener('change', ()=> totalNumbersInput.value = Math.max(5, parseInt(totalNumbersInput.value||'30',10)));
  ensureGrid(n);
  // set default speed button visual
  document.querySelectorAll('.speed .opt').forEach(o=>{
    if(parseInt(o.dataset.speed,10) === (state.speed||1000)) o.style.boxShadow='inset 0 0 0 2px rgba(255,195,0,0.2)';
  });
  // try preload voices
  setTimeout(()=>speechSynthesis.getVoices(),500);
})();

</script>
</body>
</html>
