<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bingo Asteria - Magic Edition</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700;900&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- TEMA M√ÅGICO / ALEGRE --- */
        :root {
            --bg-deep: #1a0b2e;
            --panel-bg: rgba(43, 20, 75, 0.85);
            --gold: #ffd700;
            --pink: #ff2e63;
            --cyan: #08d9d6;
            --white: #eaeaea;
            --border: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background-color: var(--bg-deep);
            color: var(--white);
            margin: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            /* Fondo M√°gico Est√°tico */
            background: linear-gradient(135deg, #2a0845 0%, #6441a5 50%, #fe5196 100%);
        }

        /* EFECTO DE HUMO / MAGIA DE FONDO */
        .fog-container {
            position: absolute; width: 100%; height: 100%; overflow: hidden; z-index: -1;
        }
        .fog-img {
            position: absolute; height: 100vh; width: 300vw; z-index: -1;
            background: url('https://raw.githubusercontent.com/danielstuart14/CSS_FOG_ANIMATION/master/fog1.png') repeat-x;
            background-size: contain;
            animation: fog 60s linear infinite;
            opacity: 0.3;
        }
        .fog-img-2 {
            background: url('https://raw.githubusercontent.com/danielstuart14/CSS_FOG_ANIMATION/master/fog2.png') repeat-x;
            background-size: contain;
            animation: fog 40s linear infinite;
            z-index: -1; top: 30%; opacity: 0.4;
        }

        @keyframes fog {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-200vw, 0, 0); }
        }

        /* --- HEADER --- */
        header {
            background: rgba(0,0,0,0.3);
            padding: 10px 20px;
            border-bottom: 2px solid var(--gold);
            display: flex; justify-content: space-between; align-items: center;
            backdrop-filter: blur(5px);
            z-index: 100;
        }

        .titulo-magico {
            font-family: 'Pacifico', cursive; margin: 0; font-size: 28px;
            background: linear-gradient(to right, #fff, #ffd700);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
        }

        .frase-energia {
            font-size: 11px; color: var(--cyan); letter-spacing: 1px; font-weight: bold;
            text-shadow: 0 0 5px var(--cyan);
            animation: pulse 3s infinite;
        }

        @keyframes pulse { 0%, 100% { opacity: 0.8; } 50% { opacity: 1; text-shadow: 0 0 15px var(--cyan); } }

        /* --- LAYOUT --- */
        .layout {
            display: grid; grid-template-columns: 1fr 360px;
            height: calc(100vh - 80px); gap: 15px; padding: 15px;
        }

        .panel {
            background: var(--panel-bg); border: 1px solid var(--border);
            border-radius: 20px; padding: 15px; display: flex; flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            position: relative; overflow: hidden;
        }

        /* --- IZQUIERDA: DATOS Y TABLERO --- */
        
        /* Barra de Estad√≠sticas */
        .stats-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px;
            background: rgba(0,0,0,0.2); padding: 10px; border-radius: 10px;
            margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.1);
        }
        .stat-item { text-align: center; }
        .stat-lbl { font-size: 9px; color: var(--cyan); text-transform: uppercase; display: block; margin-bottom: 2px;}
        
        .input-magico {
            background: rgba(0,0,0,0.3); border: 1px solid var(--pink); color: white;
            width: 60px; text-align: center; border-radius: 5px; font-weight: bold; padding: 3px;
        }

        /* Tablero */
        .grid-wrapper { flex: 1; overflow-y: auto; padding-right: 5px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(75px, 1fr)); gap: 8px; }

        .card {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px; padding: 5px; display: flex; flex-direction: column;
            align-items: center; cursor: pointer; transition: 0.2s; position: relative;
        }
        .card:hover { background: rgba(255,255,255,0.1); border-color: var(--cyan); }
        .card.pagado { box-shadow: inset 0 0 10px rgba(0, 255, 136, 0.4); border-color: #00ff88; }

        .card-num { font-size: 20px; font-weight: 900; color: #fff; }
        .card-name { font-size: 9px; color: #aaa; width: 100%; text-align: center; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Estrellas */
        .stars { display: flex; gap: 2px; margin-top: 2px; }
        .star { font-size: 8px; color: #444; }
        .star.on { color: var(--gold); text-shadow: 0 0 5px var(--gold); transform: scale(1.3); }

        /* Ganador */
        .card.winner {
            background: linear-gradient(45deg, #ffd700, #ff8c00);
            border: 2px solid white; transform: scale(1.1); z-index: 10;
            box-shadow: 0 0 20px var(--gold);
        }
        .card.winner .card-num, .card.winner .card-name { color: black; font-weight: 900; }
        .card.winner .star { color: black !important; }
        .crown { display: none; position: absolute; top: -15px; color: var(--gold); font-size: 20px; animation: bounce 1s infinite; z-index: 20; text-shadow: 0 2px 4px black;}

        /* --- DERECHA: CONTROLES --- */
        
        /* Bola 3D */
        .ball-zone {
            height: 160px; display: flex; justify-content: center; align-items: center;
            background: radial-gradient(closest-side, rgba(255,255,255,0.1), transparent);
            margin-bottom: 10px;
        }
        .ball-3d {
            width: 130px; height: 130px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #fff, #ff0055, #59001d);
            box-shadow: 0 0 30px var(--pink);
            display: flex; align-items: center; justify-content: center;
            border: 3px solid white;
            transition: transform 0.3s;
        }
        .ball-num { font-size: 60px; font-weight: 900; color: white; text-shadow: 2px 2px 0px #000; }

        /* Controles Velocidad */
        .speed-box {
            display: flex; justify-content: center; gap: 5px; margin-bottom: 10px;
            background: rgba(0,0,0,0.3); padding: 5px; border-radius: 20px;
        }
        .speed-btn {
            background: transparent; border: 1px solid #555; color: #888;
            padding: 5px 15px; border-radius: 15px; cursor: pointer; font-size: 11px;
        }
        .speed-btn.active { background: var(--cyan); color: black; font-weight: bold; border-color: var(--cyan); box-shadow: 0 0 10px var(--cyan); }

        /* Botones Principales */
        .btn-action {
            width: 100%; padding: 15px; border: none; border-radius: 8px;
            font-weight: 900; font-size: 16px; cursor: pointer; text-transform: uppercase;
            margin-bottom: 8px; transition: 0.2s;
        }
        .btn-start {
            background: linear-gradient(90deg, #00f2ff, #0099ff); color: #000;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.4);
        }
        .btn-stop {
            background: linear-gradient(90deg, #ff0055, #ff0000); color: #fff; display: none;
            box-shadow: 0 0 15px rgba(255, 0, 85, 0.4);
        }
        .btn-new { background: transparent; border: 1px solid #666; color: #aaa; font-size: 12px; padding: 10px; }

        /* Historial y Premios */
        .history-box {
            background: rgba(0,0,0,0.3); padding: 10px; border-radius: 8px;
            height: 100px; overflow-y: auto; margin-bottom: 10px;
            font-size: 11px; text-align: center; border: 1px solid rgba(255,255,255,0.1);
        }
        .history-item { margin-bottom: 4px; color: #ccc; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .history-new { color: var(--gold); font-weight: bold; font-size: 13px; }

        .prizes-box {
            flex: 1; overflow-y: auto; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 8px;
        }
        .prize-row { display: flex; gap: 5px; margin-bottom: 5px; }
        .prize-input { width: 100%; background: transparent; border: 1px solid #444; color: var(--gold); padding: 5px; font-size: 11px; text-align: center; }

        /* Modal */
        .modal { display: none; position: fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:999; justify-content:center; align-items:center; }
        .modal-content { background: #1a0b2e; border: 2px solid var(--cyan); padding: 20px; border-radius: 15px; width: 300px; text-align: center; box-shadow: 0 0 30px var(--cyan); }
        input.form { width: 90%; padding: 10px; margin: 5px 0; background: #0f041c; border: 1px solid #444; color: white; border-radius: 5px; }

        @keyframes bounce { 0%,100%{transform:translateX(-50%) translateY(0);} 50%{transform:translateX(-50%) translateY(-5px);} }
        #confetti { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 999; }

    </style>
</head>
<body>

    <div class="fog-container">
        <div class="fog-img"></div>
        <div class="fog-img fog-img-2"></div>
    </div>
    <canvas id="confetti"></canvas>

    <header>
        <div>
            <h1 class="titulo-magico">Bingo Asteria</h1>
            <div class="frase-energia">‚ú® Que las estrellas y el universo acompa√±en nuestra energ√≠a de ganar ‚ú®</div>
        </div>
        <div style="text-align: right;">
            <a href="#" style="color:var(--gold); font-size:12px; text-decoration:none;">bingoasteriaperu.online</a><br>
            <a href="#" style="color:var(--pink); font-size:12px; text-decoration:none;">Fan Page Facebook</a>
        </div>
    </header>

    <div class="layout">
        
        <div class="panel">
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-lbl">COSTO TICKET</span>
                    <input type="text" class="input-magico" value="S/ 5.00">
                </div>
                <div class="stat-item">
                    <span class="stat-lbl">INSCRITOS</span>
                    <div id="player-count" style="font-weight:bold; font-size:18px; color:var(--cyan)">0</div>
                </div>
                <div class="stat-item">
                    <span class="stat-lbl">N√öMEROS</span>
                    <input type="number" id="cfg-total" class="input-magico" value="50" onchange="initGame()">
                </div>
                <div class="stat-item">
                    <span class="stat-lbl">PREMIO TOTAL</span>
                    <input type="text" class="input-magico" value="S/ 100">
                </div>
            </div>

            <div style="display:flex; justify-content:space-between; font-size:10px; color:#aaa; margin-bottom:5px;">
                <span>TABLERO (5 ACIERTOS PARA GANAR)</span>
                <span>Clic en n√∫mero para registrar</span>
            </div>

            <div class="grid-wrapper">
                <div class="grid" id="grid"></div>
            </div>
        </div>

        <div class="panel">
            <div class="ball-zone">
                <div class="ball-3d" id="ball-vis">
                    <div class="ball-num" id="ball-val">--</div>
                </div>
            </div>

            <div class="speed-box">
                <span style="font-size:10px; color:#aaa; line-height:25px;">VELOCIDAD:</span>
                <button class="speed-btn" onclick="setSpeed(3000, this)" id="sp-1">1x</button>
                <button class="speed-btn active" onclick="setSpeed(2000, this)" id="sp-15">1.5x</button>
                <button class="speed-btn" onclick="setSpeed(1000, this)" id="sp-2">2x</button>
            </div>

            <button id="btn-start" class="btn-action btn-start" onclick="toggleAutoDraw()">INICIAR SORTEO</button>
            <button id="btn-stop" class="btn-action btn-stop" onclick="toggleAutoDraw()">DETENER</button>
            <button class="btn-action btn-new" onclick="location.reload()">NUEVO JUEGO</button>

            <div style="font-size:10px; color:var(--cyan); margin-top:10px;">N√öMEROS SALIENTES</div>
            <div class="history-box" id="history-list">
                <div style="padding:10px;">El historial aparecer√° aqu√≠...</div>
            </div>

            <div style="font-size:10px; color:var(--gold); display:flex; justify-content:space-between;">
                <span>LISTA DE PREMIOS</span>
                <span style="cursor:pointer;" onclick="addPrize()">[+ Agregar]</span>
            </div>
            <div class="prizes-box" id="prizes-list"></div>

            <div style="font-size:10px; color:var(--success); margin-top:5px;">GANADORES (5 ACIERTOS)</div>
            <div id="winners-list" style="height:60px; overflow-y:auto; font-size:11px; color:white; background:rgba(0,0,0,0.3); padding:5px;">
                ...
            </div>
        </div>
    </div>

    <div class="modal" id="modal-reg">
        <div class="modal-content">
            <h3 style="color:var(--cyan); margin-top:0;">REGISTRAR #<span id="reg-id"></span></h3>
            <input type="text" id="reg-name" class="form" placeholder="Nombre">
            <input type="text" id="reg-tel" class="form" placeholder="Tel√©fono">
            <div style="text-align:left; margin:10px 0; color:white;">
                <input type="checkbox" id="reg-paid"> PAGO CONFIRMADO (Verde)
            </div>
            <button onclick="savePlayer()" style="background:var(--cyan); color:black; border:none; padding:10px 20px; font-weight:bold; cursor:pointer;">GUARDAR</button>
            <button onclick="document.getElementById('modal-reg').style.display='none'" style="background:transparent; color:#888; border:none; margin-top:10px; cursor:pointer;">Cancelar</button>
        </div>
    </div>

    <script>
        // --- LOGICA ---
        let totalNums = 50;
        let players = {};
        let counts = {};
        let currentDrawSpeed = 2000; // 1.5x default
        let autoDrawInterval = null;
        let isDrawing = false;
        let drawnNumbers = [];
        let prizes = ["Premio N√∫mero 1: S/ 20.00", "Premio N√∫mero 2: S/ 15.00"];
        let editId = null;

        // --- INICIO ---
        function initGame() {
            totalNums = parseInt(document.getElementById('cfg-total').value);
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            counts = {};
            
            for(let i=1; i<=totalNums; i++) {
                counts[i] = 0;
                if(!players[i]) players[i] = { name: '', tel: '', paid: false };

                let card = document.createElement('div');
                card.className = 'card';
                card.id = 'card-' + i;
                card.onclick = () => openReg(i);
                renderCard(card, i);
                grid.appendChild(card);
            }
            updatePlayerCount();
            renderPrizes();
        }

        function renderCard(el, i) {
            let p = players[i];
            let name = p.name ? p.name : 'LIBRE';
            let color = p.name ? 'var(--cyan)' : '#aaa';
            if(p.paid) el.classList.add('pagado'); else el.classList.remove('pagado');

            el.innerHTML = `
                <div class="crown" id="crown-${i}"><i class="fas fa-crown"></i></div>
                <div class="card-num">${i}</div>
                <div class="card-name" style="color:${color}">${name}</div>
                <div class="stars">
                    ${[1,2,3,4,5].map(s => `<i class="fas fa-star star" id="s-${i}-${s}"></i>`).join('')}
                </div>
            `;
        }

        // --- AUTO DRAW ---
        function toggleAutoDraw() {
            if(isDrawing) {
                // Detener
                clearInterval(autoDrawInterval);
                isDrawing = false;
                document.getElementById('btn-start').style.display = 'block';
                document.getElementById('btn-stop').style.display = 'none';
            } else {
                // Iniciar
                isDrawing = true;
                document.getElementById('btn-start').style.display = 'none';
                document.getElementById('btn-stop').style.display = 'block';
                drawStep(); // Primer paso inmediato
                autoDrawInterval = setInterval(drawStep, currentDrawSpeed);
            }
        }

        function setSpeed(ms, btn) {
            currentDrawSpeed = ms;
            document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            if(isDrawing) {
                clearInterval(autoDrawInterval);
                autoDrawInterval = setInterval(drawStep, currentDrawSpeed);
            }
        }

        function drawStep() {
            // Animacion bola
            let ball = document.getElementById('ball-vis');
            ball.style.transform = "rotate(360deg) scale(1.1)";
            setTimeout(() => ball.style.transform = "rotate(0deg) scale(1)", 300);

            // Generar n√∫mero (con repeticion para llenar estrellas)
            let num = Math.floor(Math.random() * totalNums) + 1;
            document.getElementById('ball-val').innerText = num;

            // VOZ
            speak(num.toString());

            // Historial
            updateHistory(num);

            // Logica juego
            if(counts[num] < 5) { // Solo cuenta si aun no gano
                counts[num]++;
                let star = document.getElementById(`s-${num}-${counts[num]}`);
                if(star) star.classList.add('on');

                // Resaltar tarjeta
                let card = document.getElementById(`card-${num}`);
                card.scrollIntoView({behavior:"smooth", block:"center"});
                card.style.borderColor = "var(--gold)";
                setTimeout(() => card.style.borderColor = "rgba(255,255,255,0.1)", 800);

                // GANADOR
                if(counts[num] === 5) {
                    toggleAutoDraw(); // Pausa el juego
                    triggerWin(num);
                }
            }
        }

        function updateHistory(num) {
            drawnNumbers.unshift(num);
            let html = `<div class="history-new">${num} <span style="font-size:9px; color:#fff;">(AHORA)</span></div>`;
            
            for(let i=1; i<drawnNumbers.length && i<10; i++) {
                html += `<div class="history-item">${drawnNumbers[i]} <span style="font-size:9px;">(Hace ${i})</span></div>`;
            }
            document.getElementById('history-list').innerHTML = html;
        }

        function triggerWin(id) {
            let card = document.getElementById(`card-${id}`);
            card.classList.add('winner');
            document.getElementById(`crown-${id}`).style.display = 'block';
            
            let pName = players[id].name || "Sin Nombre";
            let wList = document.getElementById('winners-list');
            if(wList.innerHTML.includes('...')) wList.innerHTML = '';
            
            let prize = "Premio S/ ??"; 
            // Logica simple de asignacion de premio
            let winCount = document.querySelectorAll('.winner').length;
            if(winCount === 1) prize = "1¬∫ Premio";
            else if(winCount === 2) prize = "2¬∫ Premio";

            wList.innerHTML += `<div>üèÜ #${id} ${pName} - ${prize}</div>`;

            speak(`¬°Ganador! N√∫mero ${id}, ${pName}`);
            fireConfetti();
            alert(`¬°TENEMOS GANADOR!\nN√∫mero: ${id}\nJugador: ${pName}`);
        }

        // --- REGISTRO ---
        function openReg(id) {
            editId = id;
            document.getElementById('reg-id').innerText = id;
            document.getElementById('reg-name').value = players[id].name;
            document.getElementById('reg-tel').value = players[id].tel;
            document.getElementById('reg-paid').checked = players[id].paid;
            document.getElementById('modal-reg').style.display = 'flex';
        }

        function savePlayer() {
            players[editId].name = document.getElementById('reg-name').value;
            players[editId].tel = document.getElementById('reg-tel').value;
            players[editId].paid = document.getElementById('reg-paid').checked;
            
            let card = document.getElementById(`card-${editId}`);
            renderCard(card, editId);
            updatePlayerCount();
            document.getElementById('modal-reg').style.display = 'none';
        }

        function updatePlayerCount() {
            let count = Object.values(players).filter(p => p.name !== '').length;
            document.getElementById('player-count').innerText = count;
        }

        // --- PREMIOS ---
        function renderPrizes() {
            let html = '';
            prizes.forEach((p, i) => {
                html += `<div class="prize-row"><input class="prize-input" style="width:90%; background:transparent; border:1px solid #555; color:white; font-size:11px; margin-bottom:2px;" value="${p}" onchange="prizes[${i}]=this.value"> <span style="color:red; cursor:pointer;" onclick="remPrize(${i})">x</span></div>`;
            });
            document.getElementById('prizes-list').innerHTML = html;
        }
        function addPrize() { prizes.push("Nuevo Premio"); renderPrizes(); }
        window.remPrize = (i) => { prizes.splice(i, 1); renderPrizes(); }

        // --- VOZ ---
        function speak(txt) {
            if('speechSynthesis' in window) {
                let msg = new SpeechSynthesisUtterance(txt);
                msg.lang = 'es-ES';
                msg.rate = 1.2;
                msg.pitch = 1.3; // Tono femenino agudo
                window.speechSynthesis.speak(msg);
            }
        }

        // --- CONFETTI ---
        const canvas = document.getElementById('confetti');
        const ctx = canvas.getContext('2d');
        let particles = [];
        window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
        window.onresize();

        function fireConfetti() {
            for(let i=0; i<200; i++) particles.push({
                x: canvas.width/2, y: canvas.height/2,
                vx: (Math.random()-0.5)*10, vy: (Math.random()-0.5)*10,
                life: 150, color: `hsl(${Math.random()*360},100%,50%)`
            });
            loopConfetti();
        }
        function loopConfetti() {
            ctx.clearRect(0,0,canvas.width,canvas.height);
            particles.forEach(p => { p.x+=p.vx; p.y+=p.vy; p.life--; ctx.fillStyle=p.color; ctx.fillRect(p.x,p.y,5,5); });
            particles = particles.filter(p => p.life>0);
            if(particles.length) requestAnimationFrame(loopConfetti);
        }

        initGame();
    </script>
</body>
</html>